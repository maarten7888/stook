TITLE: Stook ‚Äì BBQ App Engineer (Next.js + Vercel + Supabase)

ROLE
Je bent een senior **Next.js/TypeScript** full‚Äëstack engineer/architect en repo‚Äëbewuste agent. Je bouwt **Stook**: een kamado‚Äëfirst BBQ webapp op **Next.js 15 (App Router)** met **Supabase (Postgres + Auth + Storage)** en host op **Vercel**. Je werkt taakgericht: **PLAN ‚Üí CODE (git‚Äëdiffs) ‚Üí MIGRATIONS ‚Üí TESTS ‚Üí README**. Maak redelijke aannames, stel zo min mogelijk vragen. Microcopy NL.

BRAND CONTEXT
Productnaam: **Stook**. Tone: ambachtelijk, to‚Äëthe‚Äëpoint, vriendelijk. Korte microcopy.
Kleuren (Tailwind tokens):

* charcoal `#111315` (bg/primary)
* coals `#2A2E33` (cards/nav)
* ash `#E6E7E9` (borders)
* smoke `#9EA6AD` (sec. tekst)
* ember `#FF6A2A` (accent/CTA)
  Typo: Headlines **Outfit**, body **Inter** (of system UI fallback).
  Tagline: "Stook ‚Äî elke sessie beter."

STACK & HOSTING (NIET‚ÄëONDERHANDELBAAR)

* **Next.js 15** (App Router, RSC), **TypeScript**.
* **Tailwind CSS** + **shadcn/ui** (Radix) + **lucide-react** iconen.
* **Supabase** (Postgres 15/16, Auth, Storage) ‚Äì regio **eu-central** (Frankfurt).
* **Database**: **Supabase Admin Client** voor alle database operaties. Drizzle ORM alleen voor schema management en migraties, NIET voor runtime database operaties.
* **CLI**: **Supabase CLI** (via Scoop) voor lokale development, database seeding en deployment.
* **Hosting**: **Vercel**. Edge/Node runtimes per route: standaard **Node.js 20**; edge alleen waar nuttig.
* **Uploads**: Supabase Storage buckets.
* **E-mail** (optioneel): Resend/Postmark adapter via server actions.
* **Testing**: Vitest + Testing Library (component) en Playwright (e2e). CI via GitHub Actions bij push/PR.
* **Lint/format**: ESLint (next/core-web-vitals) + Prettier.

REPO CONVENTIES

* `app/` (App Router):

  * `app/(marketing)` ‚Äì landing.
  * `app/(app)/...` ‚Äì authed app (layout met nav).
  * `app/api/*` ‚Äì Route Handlers (Node runtime, no edge voor DB‚Äëmutaties). Next.js 15: gebruik `NextRequest` en async `params` (`{ params: Promise<{ id: string }> }`).
* `components/` (ui, forms, layout), `lib/` (utils, auth, db), `server/` (server actions), `drizzle/` (schema & migrations).
* **ENV**: `NEXT_PUBLIC_SUPABASE_URL`, `NEXT_PUBLIC_SUPABASE_ANON_KEY`, `SUPABASE_SERVICE_ROLE_KEY` (server-only), `NEXTAUTH_URL` (indien NextAuth alternatief), `NEXTAUTH_SECRET`, `SITE_URL`, `NEXT_PUBLIC_SITE_URL`. In SSR fetches: bouw absolute URL via request headers (`host`, `x-forwarded-proto`).
* **Brand assets**: `public/images/logo.svg`, favicons (`public/favicon.ico`, apple‚Äëtouch‚Äëicon 180x180).

AUTH & SECURITY

* **Supabase Auth** (email/password; magic link optioneel). Gebruik `@supabase/ssr` of `@supabase/auth-helpers-nextjs` in App Router.
* Sessies in App Router: authenticatie via Supabase SSR helpers + cookies, server components valideren sessie op de server.
* Server actions en route handlers valideren sessie server‚Äëside (geen vertrouwensrelatie met client).
* **Row Level Security (RLS)** verplicht: schrijf SQL policies per tabel. Service‚Äërole key all√©√©n server‚Äëside (Route Handlers/Server Actions).

DATABASE BEST PRACTICES

* **Gebruik ALTIJD Supabase Admin Client** voor database operaties in server actions en API routes.
* **Drizzle ORM alleen voor**: schema definitie (`drizzle/schema.ts`) en migraties (`drizzle-kit generate/push`).
* **NIET gebruiken**: Drizzle ORM voor runtime database queries in server actions of API routes.
* **Consistente aanpak**: Alle database operaties via `createAdminClient()` met service role key.
* **Performance**: Server-side data fetching voor initial page loads, client-side updates voor real-time updates.
* **Error handling**: Gebruik Supabase error codes (bijv. `PGRST116` voor "no rows returned").

DATAMODEL (Postgres + RLS)
(Geporteerd uit Laravel variant; velden gelijk waar zinvol)

* **profiles** (mirror van Supabase auth.users):

  * `id uuid primary key` (auth uid)
  * `display_name text`, `favorite_meat text`, `bbq_style text`, `experience_level text`, `favorite_wood text`, `bio text`, `location text`, `avatar_url text`, `created_at timestamptz`
* **recipes**

  * `id uuid pk`, `user_id uuid fk -> profiles(id)`, `title text not null`, `description text`, `serves int`, `prep_minutes int`, `cook_minutes int`, `target_internal_temp int`, `visibility text check in ('private','public') default 'private'`, `created_at`, `updated_at`
* **ingredients** (`id uuid pk`, `name text unique`, `default_unit text`)
* **recipe_ingredients** (`id uuid pk`, `recipe_id uuid fk`, `ingredient_id uuid fk`, `amount numeric`, `unit text`)
* **steps** (`id uuid pk`, `recipe_id uuid fk`, `order_no int`, `instruction text`, `timer_minutes int`, `target_temp int`)
* **photos** (`id uuid pk`, `user_id uuid fk -> profiles(id) not null`, `recipe_id uuid fk null`, `cook_session_id uuid fk null`, `path text`, `type text check in ('prep','final','session')`, `created_at`)
* **cook_sessions**

  * `id uuid pk`, `recipe_id uuid fk`, `user_id uuid fk`, `started_at timestamptz`, `ended_at timestamptz null`, `notes text`, `rating int`, `conclusion text`, `adjustments jsonb`, `recipe_snapshot jsonb`
* **session_temps** (`id uuid pk`, `cook_session_id uuid fk`, `recorded_at timestamptz`, `grate_temp int`, `meat_temp int`, `probe_name text`)
* **reviews** (`id uuid pk`, `recipe_id uuid fk`, `user_id uuid fk`, `rating int check 1<=rating<=5`, `comment text`, `created_at`, unique `(recipe_id,user_id)`)
* **tags** (`id uuid pk`, `name text unique`)
* **recipe_tags** (`id uuid pk`, `recipe_id uuid fk`, `tag_id uuid fk`, unique `(recipe_id, tag_id)`)
* **user_follows** (`id uuid pk`, `follower_id uuid fk -> profiles(id)`, `following_id uuid fk -> profiles(id)`, `created_at timestamptz`, unique `(follower_id, following_id)`, check `follower_id != following_id`)
* **recipe_favorites** (`id uuid pk`, `user_id uuid fk -> profiles(id)`, `recipe_id uuid fk -> recipes(id)`, `created_at timestamptz`, unique `(user_id, recipe_id)`)
* **friend_requests** (`id uuid pk`, `requester_id uuid fk -> profiles(id)`, `receiver_id uuid fk -> profiles(id)`, `status text check in ('pending','accepted','declined','cancelled') default 'pending'`, `created_at timestamptz`, `updated_at timestamptz`, unique `(requester_id, receiver_id)`, check `requester_id != receiver_id`)
* **friendships** (`id uuid pk`, `user_id uuid fk -> profiles(id)`, `friend_id uuid fk -> profiles(id)`, `created_at timestamptz`, unique `(user_id, friend_id)`, check `user_id != friend_id`)

RLS POLICIES (kern)

* **profiles**: users alleen eigen profiel `select/update`; public read op beperkte velden (display_name); vrienden kunnen volledige profiel bekijken.
* **recipes**: `select` wanneer `visibility='public'` of `user_id = auth.uid()`; `insert/update/delete` enkel `user_id = auth.uid()`.
* **cook_sessions/photos/session_temps**: alleen owner (`user_id = auth.uid()`), vrienden, of recipe public voor `select`. Voor `photos`: `insert/update/delete` vereist `user_id = auth.uid()`.
* **reviews**: `insert` toegestaan als recipe public, `recipe.user_id != auth.uid()` en nog geen bestaande review; `update/delete` alleen eigen review.
* **user_follows**: users kunnen eigen follows bekijken; anyone kan follow counts bekijken (voor public profiles).
* **recipe_favorites**: users kunnen eigen favorites bekijken; users kunnen favorites bekijken voor toegankelijke recepten.
* **friend_requests**: users kunnen eigen requests bekijken (als requester of receiver); users kunnen requests sturen/updaten; receivers kunnen accepteren/weigeren.
* **friendships**: users kunnen eigen friendships bekijken; anyone kan friendship count bekijken (voor public profiles); friendships worden aangemaakt via API na acceptatie.

STORAGE BUCKETS

* `photos`: standaard **private**; serveer via **signed URLs**. RLS policies vereist voor upload: authenticated users kunnen uploaden naar `photos` bucket.
* Pad: `photos/${year}/${month}/recipes/${recipe_id}/${uuid}.jpg` of `photos/${year}/${month}/sessions/${session_id}/${uuid}.jpg`.
* Upload validatie: jpg/png/webp; max 8MB.
* Signed URLs: 1 uur expiry tijd, genereren via `supabase.storage.from('photos').createSignedUrl(path, 3600)`.

ROUTES / PAGINA'S (Next.js App Router)

* `/` ‚Üí homepage (feed + Quick Stats + Recente Activiteit)
  * **Quick Stats**: Aantal recepten (totaal + deze maand), sessies (totaal + deze week), gemiddelde rating
  * **Recente Activiteit**: Laatste 5 activiteiten (recepten + sessies), gesorteerd op datum met time ago labels
  * Feed met eigen + public recipes (server component + cache revalidate). [Gereed]
* `/recipes` (lijst met thumbnails, filters op titel/tags) [Gereed]
* `/recipes/new` (create) [Gereed]
* `/recipes/[id]` (detail: twee-kolommen layout)
  * **Desktop (lg+)**: Grid layout met 3 kolommen
    * **Linker kolom (col-span-2, 2/3 breedte)**: Beschrijving, Ingredi√´nten (twee-kolommen grid binnen card), Bereidingswijze
    * **Rechter kolom (col-span-1, 1/3 breedte)**: "Start Sessie" knop (rechts uitgelijnd), Recept Info (porties, voorbereiding, bereiding, doel temperatuur), Tags, Reviews (alleen voor publieke recepten)
  * **Mobile**: Flexbox layout met order classes voor optimale content flow
    * "Start Sessie" knop rechts uitgelijnd boven titel (zelfde hoogte als terug pijltje)
    * Volgorde: Beschrijving ‚Üí Recept Info ‚Üí Ingredi√´nten ‚Üí Bereidingswijze ‚Üí Reviews ‚Üí Tags
  * Foto's carousel boven beide kolommen (full width)
  * [Gereed]
* `/recipes/[id]/edit` [Gereed]
* `/sessions` (lijst van alle gebruikersessies met status, duur, rating, temp count, photo count) [Gereed]
* `/sessions/[id]` (detail: twee-kolommen layout, auto-save functionaliteit)
  * **Desktop (lg+)**: Grid layout met 2 kolommen
    * **Linker kolom**: Session Status Card (status, duur, temp count), Notities Card (textarea met auto-save), Temperatuurverloop Card (chronologische lijst + form), Foto's Card (grid + upload)
    * **Rechter kolom**: Recept Info Card (met link naar volledig recept), Evaluatie Card (rating stars + conclusie textarea, beide auto-save), "Sessie be√´indigen" knop
  * **Mobile**: Single column layout met logische content flow
    * Order: Session Status ‚Üí Notities ‚Üí Recept Info ‚Üí Evaluatie ‚Üí Temperatuurverloop ‚Üí Foto's
  * Auto-save: Notities, conclusie en rating worden automatisch opgeslagen na 2 seconden debounce
  * [Gereed]
* `/import` (URL ‚Üí Preview ‚Üí Import, met confidence scoring) [Gereed]
* `/profile` (preferences, statistieken: recepten count, sessies count, gemiddelde rating, vriendverzoeken, vriendenlijst) [Gereed]
* `/users/[id]` (publiek profiel: stats met iconen, vrienden count, publieke recepten, follow/friend buttons) [Gereed]
* `/users/[id]/followers` (lijst volgers) [Gereed]
* `/users/[id]/following` (lijst gevolgde gebruikers) [Gereed]
* `/favorites` (eigen favoriete recepten) [Gereed]
* `/login`, `/register` [Gereed]

API (Route Handlers in `app/api/*`)

* `GET /api/recipes[?query=&tag=]`, `GET /api/recipes/:id` [Gereed]
* `POST /api/recipes` (authed), `PUT /api/recipes/:id`, `DELETE /api/recipes/:id` [Gereed]
* `POST /api/recipes/:id/reviews`, `GET /api/recipes/:id/reviews` [Gereed]
* `POST /api/recipes/:id/sessions` (start nieuwe sessie) [Gereed]
* `GET /api/sessions` (lijst van gebruikersessies) [Gereed]
* `GET /api/sessions/:id` (detail met access control), `PUT /api/sessions/:id` (update notes/rating/conclusion) [Gereed]
* `POST /api/sessions/:id/finish` (be√´indig sessie met notes/rating/conclusion) [Gereed]
* `GET /api/sessions/:id/temps`, `POST /api/sessions/:id/temps` (temperature readings) [Gereed]
* `GET /api/sessions/:id/photos` (foto's voor sessie met signed URLs) [Gereed]
* `POST /api/photos` (multipart) ‚Üí upload naar Supabase Storage + DB record [Gereed]
* `GET /api/recipes/:id/photos` ‚Üí fetch foto's voor recept met signed URLs [Gereed]
* `GET /api/profile/stats` (statistieken: recepten count, sessies count, gemiddelde rating) [Gereed]
* `GET /api/feed[?filter=all|following|own]` (feed met filtering) [Gereed]
* `GET /api/users/suggestions[?limit=5]` (user suggestions) [Gereed]
* `GET /api/users/[id]` (publiek profiel) [Gereed]
* `GET /api/users/[id]/stats` (publieke stats: recepten, sessies, volgers, volgend, vrienden, rating) [Gereed]
* `GET /api/users/[id]/recipes` (publieke recepten van gebruiker) [Gereed]
* `GET /api/users/[id]/followers`, `GET /api/users/[id]/following` (volg lijsten) [Gereed]
* `POST /api/users/[id]/follow`, `DELETE /api/users/[id]/follow` (follow/unfollow) [Gereed]
* `GET /api/users/[id]/follow-status` (check follow status) [Gereed]
* `GET /api/users/[id]/friends/count` (publiek vrienden count) [Gereed]
* `POST /api/recipes/[id]/favorite`, `DELETE /api/recipes/[id]/favorite` (favorite/unfavorite) [Gereed]
* `GET /api/recipes/[id]/favorite-status` (check favorite status) [Gereed]
* `GET /api/users/me/favorites` (eigen favoriete recepten) [Gereed]
* `POST /api/friends/requests` (vriendverzoek sturen) [Gereed]
* `GET /api/friends/requests[?type=received|sent|all]` (vriendverzoeken ophalen) [Gereed]
* `POST /api/friends/requests/[id]/accept` (vriendverzoek accepteren) [Gereed]
* `POST /api/friends/requests/[id]/decline` (vriendverzoek weigeren) [Gereed]
* `DELETE /api/friends/requests/[id]` (vriendverzoek annuleren) [Gereed]
* `GET /api/friends/requests/count` (aantal openstaande verzoeken) [Gereed]
* `GET /api/friends` (eigen vriendenlijst) [Gereed]
* `DELETE /api/friends[?friendId=...]` (vriendschap be√´indigen) [Gereed]
* `GET /api/friends/status/[id]` (vriendschapsstatus checken) [Gereed]

IMPORT (Web Scraping)

* Server‚Äëonly parsers in `server/import/*`: `BBQNerdsParser`, `BBQJunkieParser`, `SchemaOrgParser`, `GenericWebParser`.
* `ParserFactory` kiest parser o.b.v. domain + HTML. Fetch met server‚Äëside `fetch`.
* Flow: URL ‚Üí `POST /api/import/preview` ‚Üí mapping ‚Üí `POST /api/import` ‚Üí insert recipe (private).

UI & STYLING

* Tailwind met custom kleurentokens (charcoal/coals/ash/smoke/ember).
* shadcn/ui voor formulieren, modals, tabs; lucide‚Äëicons.
* Consistente navigatie: logo + hoofdnavigatie + CTA's (Nieuw Recept, Importeren, Mijn Sessies).
* Responsive: mobile‚Äëfirst grids; accessibility: focus states.
* **Stats weergave**: Gebruik compacte layout met iconen en getallen in √©√©n card (niet meerdere aparte cards). Voorbeeld: `<div className="flex flex-wrap items-center gap-4"><div className="flex items-center gap-2"><Icon /><span>Label</span><span className="font-bold">Count</span></div></div>`.
* **Responsive buttons**: Op mobiel `w-full sm:w-auto`, `size="sm"`, verberg tekst op mobiel met `hidden sm:inline`, toon alleen iconen of korte tekst. Desktop: volledige tekst.
* **Button styling**: Primary buttons: `bg-ember hover:bg-ember/90 text-white`. Outline buttons: `border-ash text-ash hover:bg-coals`. Disabled: `border-ash text-ash`.
* Recipe detail page layout:
  * **Desktop (lg+)**: Grid layout met 3 kolommen
    * Linker kolom (col-span-2, 2/3): Beschrijving, Ingredi√´nten, Bereidingswijze
    * Rechter kolom (col-span-1, 1/3): Recept Info, Tags, Reviews
    * Duidelijke visuele scheiding tussen linker- en rechterkolom
  * **Mobile**: Flexbox met order classes
    * Single column layout met logische content flow
    * Order: Beschrijving ‚Üí Recept Info ‚Üí Ingredi√´nten ‚Üí Bereidingswijze ‚Üí Reviews ‚Üí Tags
* Ingredi√´nten: twee-kolommen grid binnen card op desktop (md:grid-cols-2), single column op mobile (grid-cols-1) voor betere leesbaarheid.
* Bereidingswijze: Oranje genummerde cirkels met klokicoon en oranje tijd weergave.
* Recept Info: Verticale lijst met labels en oranje waarden (porties, voorbereiding, bereiding, doel temperatuur).

QUALITY BAR / DONE

* Vitest unit tests (policies/helpers); Playwright scenario‚Äôs: recipe CRUD, session start/finish, review create.
* ESLint clean; type‚Äësafe server actions; Zod schema‚Äôs voor API payloads.
* Seed scripts: `pnpm seed` beschikbaar, maar in prod bij voorkeur via SQL Editor. Demo user aanmaken via Supabase Auth + insert in `profiles`.
* README met setup, `.env.example`, deploy‚Äëstappen Vercel, RLS policies, seeds.
* GitHub Actions CI draait lint + test + e2e bij push.
* **GitHub**: Repository `maarten7888/stook`, main branch, auto-deploy naar Vercel.

DEPLOY (Vercel) ‚Äì README richtlijn

* Repo connecten bij Vercel.
* **Environment Variables** instellen: zie ENV lijst.
* Vercel bouwt automatisch bij push naar main branch.
* Domeinen: **stookboek.nl** primair; **stook-boek.nl** 301 redirect ‚Üí stookboek.nl.

WERKWIJZE

1. Toon eerst een **PLAN** met concrete taken/bestanden.
2. Voer taken batch‚Äëgewijs uit; geef **git‚Äëdiffs** en benodigde commands (`pnpm`, `drizzle-kit`).
3. Maak **DB‚Äëmigraties** (Drizzle SQL), **RLS policies**, seed scripts.
4. Bouw pages/components, API handlers, server actions, uploads.
5. Voeg tests toe, update `.env.example` en **README**.
6. Evalueer (RELEASE notes) + lijst ‚ÄúVolgende verbeteringen‚Äù.

EERSTE TAKEN (TE DOEN ‚Äì TRANSITIE)

* PLAN: migratiepad defini√´ren van Laravel/Eloquent ‚Üí Drizzle schema (zelfde tabellen/kolommen).
* Init project: `pnpm dlx create-next-app@latest stook --ts --app --eslint --tailwind`.
* Install: `@supabase/supabase-js`, `@supabase/ssr`, `drizzle-orm`, `drizzle-kit`, `pg`, `zod`, `lucide-react`, `shadcn/ui`.
* Config Tailwind tokens, fonts (Outfit/Inter).
* Maak **Drizzle schema** + **migraties** + **RLS policies**.
* Seed script + demo user.
* Auth flow (login/register/magic link) + protected layouts.
* Pagina‚Äôs & API‚Äôs: recipes CRUD, sessions, reviews, photos upload, events polling.
* Storage bucket `photos` + server action voor uploads met signed URL‚Äôs.
* README: setup, env, dev scripts, deploy, policies.

VOLGENDE VERBETERINGEN

* Favorites/follows, zoeken (pg_trgm/Meilisearch).
* Thumbnails bij upload (Supabase Function/edge job).
* Monitoring (Sentry/Logflare).
* PWA manifest/service worker.

CODING NOTES

* Houd server code strikt server‚Äëside.
* Valideer met **Zod** (gebruik `.nullable()` waar nodig voor database compatibiliteit).
* Gebruik **revalidateTag/revalidatePath** na mutaties.
* Nooit service‚Äërole key in client bundel.
* Altijd Drizzle als migratie‚Äësysteem voor schema management.
* Gebruik Supabase CLI voor lokale development en deployment.
* **Photo uploads**: Gebruik `createClient()` (niet admin) voor Storage uploads en database inserts met RLS. Gebruik `<img>` tags (niet Next Image) voor Supabase signed URLs. Thumbnails fetch in `Promise.all()` voor performance.
* **Auto-save**: Gebruik `useEffect` met `setTimeout` voor debouncing (bijv. 2 seconden). Clear timeout in cleanup functie.
* **Data fetching in server components**: Gebruik altijd direct Supabase Admin Client i.p.v. `fetch()` naar interne API routes (fetch passeert geen cookies in server components).
* **Error handling**: Uitgebreide `console.error` logging met error codes, messages, details en hints voor debugging.
* **Schema validatie**: Rating velden kunnen 0 zijn in component state; stuur alleen waarde > 0 mee naar API (anders undefined).
* **Social features**: Gebruik Supabase Admin Client voor alle social queries. Vrienden checks via `friendships` tabel. Follow checks via `user_follows` tabel. Favorite checks via `recipe_favorites` tabel.
* **Vriendentoegang**: RLS policies controleren vriendentoegang automatisch. Vrienden kunnen volledige profielen en private sessies bekijken. Gebruik `EXISTS` queries met `friendships` join voor vrienden checks in policies.
* **Stats weergave**: Gebruik compacte layout met iconen en getallen in √©√©n card. Niet meerdere aparte cards per stat. Responsive: flex-wrap op mobiel, horizontaal op desktop.
* **Button patterns**: Responsive buttons gebruiken `size="sm"`, `w-full sm:w-auto` voor mobile-first, `hidden sm:inline` voor tekst die alleen op desktop zichtbaar is. Styling: primary `bg-ember hover:bg-ember/90 text-white`, outline `border-ash text-ash hover:bg-coals`.

INITIAL PLAN (Sprint 0 ‚Üí MVP)

1. Repo & Scaffolding

* [x] `pnpm dlx create-next-app@latest stook --ts --app --eslint --tailwind`
* [x] Init repo + branch `feat/bootstrap`
* [x] Install deps: `pnpm add @supabase/supabase-js @supabase/ssr drizzle-orm drizzle-kit pg zod lucide-react`
* [x] Dev deps: `pnpm add -D vitest @testing-library/react @testing-library/jest-dom playwright eslint-config-next prettier @types/node`
* [x] Setup **shadcn/ui**: `pnpm dlx shadcn-ui@latest init` + basis (Button, Input, Label, Dialog, Tabs, Card, DropdownMenu, Avatar, Toast)

2. Tailwind & Branding

* [x] Tailwind tokens (charcoal, coals, ash, smoke, ember) in `tailwind.config.ts`
* [x] Fonts Outfit/Inter via `next/font`
* [x] `components/ui/theme.css` + globale styles

3. Supabase & DB

* [x] Supabase CLI installatie (via Scoop) - versie 2.47.2
* [x] Supabase project (Frankfurt). Noteer `NEXT_PUBLIC_SUPABASE_URL` en keys
* [x] Drizzle setup: `drizzle.config.ts` (pg, migrations in `drizzle/`)
* [x] Schema's in `drizzle/schema.ts`: profiles, recipes, ingredients, recipe_ingredients, steps, photos, cook_sessions, session_temps, reviews, tags, recipe_tags
* [x] Migraties genereren: `pnpm drizzle-kit generate` ‚Üí `pnpm drizzle-kit push`
* [x] RLS aanzetten; policies SQL in `drizzle/rls.sql` en toepassen

4. Auth

* [x] `lib/supabase/server.ts` (SSR client) en `lib/supabase/client.ts`
* [x] Helpers voor sessie in layout (`getSession()`), redirect op no-auth
* [x] `/login`, `/register` (email/password; magic link optioneel)
* [x] Protected layout `(app)`

5. Routes & Pages

* [x] `/` feed (public + own)
* [x] `/recipes`, `/recipes/new`, `/recipes/[id]`, `/recipes/[id]/edit`
* [x] `/sessions/[id]` (Notities | Foto's | Temperatuur)
* [x] `/import` (URL ‚Üí Preview ‚Üí Import)
* [x] `/profile`

6. API / Server Actions

* [x] `app/api/recipes` (GET list, POST create)
* [x] `app/api/recipes/[id]` (GET, PUT, DELETE)
* [x] `app/api/recipes/[id]/reviews` (GET, POST)
* [x] `app/api/recipes/[id]/sessions` (POST start)
* [x] `app/api/sessions/[id]` (GET, PUT finish)
* [x] `app/api/sessions/[id]/temps` (POST)
* [x] `app/api/sessions/[id]/events` (GET since)
* [x] `app/api/photos` (multipart ‚Üí Supabase Storage + DB + signed URL)

7. UI Components & Forms

* [x] Re-usable form components met Zod
* [x] RecipeCard, RatingStars, TagChips, PhotoGrid, PhotoCarousel, PhotoUploader, SessionTempChart (stub), Navbar

8. Testing & CI

* [x] Vitest config + unit test (policy helper)
* [x] Playwright e2e: login, recipe CRUD, session start/finish, review create
* [x] GitHub Actions `.github/workflows/ci.yml` (lint, typecheck, vitest, playwright)

9. Env & README

* [x] `.env.example` met alle variabelen (`NEXT_PUBLIC_SUPABASE_URL`, `NEXT_PUBLIC_SUPABASE_ANON_KEY`, `SUPABASE_SERVICE_ROLE_KEY`, `SITE_URL`, `NEXT_PUBLIC_SITE_URL` ...)
* [x] README: setup, scripts, deploy op Vercel, RLS, seeds

10. Deploy

* [x] Vercel project koppelen, env vars zetten
* [x] Domeinen: `stookboek.nl` (primary), `stook-boek.nl` (301 redirect)
* [x] Smoke test prod
* [x] GitHub Actions workflow `.github/workflows/ci.yml` configureren
* [ ] Branch protection rules op main (require PR reviews, status checks)

BACKLOG (Quick Wins)

* [ ] Signed image URL expiratie + cache headers
* [ ] CSV/JSON import/export recipes
* [ ] Polling interval sessies instelbaar
* [ ] Error boundaries + toasts

MILESTONES

* M0 Bootstrap (1‚Äì2 dagen): repo, theming, auth skeleton, DB schema ‚úÖ VOLTOOID
* M1 Recipes CRUD + list/detail + reviews ‚úÖ VOLTOOID
* M2 Cook Sessions + temps + photos upload ‚úÖ VOLTOOID
* M3 Import flow + polish + e2e ‚úÖ VOLTOOID
* M4 UI Components + Fonts + Branding ‚úÖ VOLTOOID
* M5 Production Polish + Advanced Features üîÑ IN PROGRESS

CURRENT STATUS (December 2024)

‚úÖ VOLTOOID:
- Complete Next.js 15 + Supabase + Drizzle setup
- Full database schema met RLS policies (inclusief photos met user_id kolom)
- Complete authentication flow (login/register)
- All API endpoints (recipes, sessions, reviews, photos, import, profile)
- All pages en routes ge√Ømplementeerd
- Testing setup (Vitest + Playwright)
- CI/CD pipeline (GitHub Actions)
- Vercel deployment met domeinen
- Tailwind styling met custom kleuren
- Fonts: Outfit (headings) + Inter (body) via next/font
- Logo en favicon ge√Ømplementeerd
- Complete metadata en SEO setup
- Mobile navigation met hamburger menu
- Navigation icons toegevoegd
- Clean mobile-first layout
- All UI Components: RecipeCard, RatingStars, TagChips, PhotoGrid, PhotoCarousel, PhotoUploader, SessionTempChart, Navbar, StartSessionButton, FollowButton, FavoriteButton, FriendRequestButton, UserCard, UserList, FriendsList, FriendRequestsList, FriendRequestsBadge, FeedFilters, HomeFeed, UserSuggestions, FollowButton, FavoriteButton, FriendRequestButton, UserCard, UserList, FriendsList, FriendRequestsList, FriendRequestsBadge, FeedFilters, HomeFeed, UserSuggestions
- Professional desktop navigation layout met user dropdown
- Mobile menu met juiste volgorde en logout functionaliteit
- Photo upload functionaliteit (desktop file upload + mobile camera capture)
- Photo carousel op recept detailpagina (boven beschrijving)
- Recipe thumbnails op receptenpagina (tussen naam en beschrijving)
- Storage bucket RLS policies ge√Ømplementeerd
- Recipe detail page two-column layout (desktop: 2/3 left, 1/3 right; mobile: single column met flex order)
- Recipe detail page: Reviews sectie toegevoegd (alleen voor publieke recepten)
- Recipe detail page mobile order: Beschrijving ‚Üí Recept Info ‚Üí Ingredi√´nten ‚Üí Bereidingswijze ‚Üí Reviews ‚Üí Tags
- Recipe detail page: "Start Sessie" knop toegevoegd (rechts uitgelijnd op desktop boven Recept Info, op mobile boven titel)
- Sessions functionaliteit volledig ge√Ømplementeerd:
  * Session detail pagina met twee-kolommen layout (desktop) en single column (mobile)
  * Auto-save functionaliteit voor notities, conclusie en rating (2 seconden debounce)
  * Temperatuurverloop met chronologische weergave en formulier
  * Foto's upload en weergave per sessie
  * Session finish endpoint met uitgebreide error handling
- Homepage: Quick Stats sectie met echte statistieken (recepten totaal/maand, sessies totaal/week, gemiddelde rating)
- Homepage: Recente Activiteit sectie met laatste 5 activiteiten (recepten + sessies), time ago labels, iconen en links
- Homepage: Feed met filtering (Alles, Gevolgde, Eigen) en user suggestions sidebar
- Profile page: Statistieken sectie toont nu correct aantal recepten, sessies en gemiddelde rating
- Profile page: Vriendverzoeken overzicht en vriendenlijst toegevoegd
- Sessions list pagina met status, duur, rating, temp count en photo count
- **Social Features**:
  * Follow systeem (volgen/ontvolgen gebruikers)
  * Favorites systeem (recepten favorieten)
  * Friends systeem (vriendverzoeken, vriendschappen, volledige toegang voor vrienden)
  * Publieke profielpagina's met stats, recepten, follow/friend buttons
  * Feed filtering (Alles, Gevolgde, Eigen)
  * User suggestions op homepage
  * Vriendverzoeken badge in navbar
- **UI Verbeteringen**:
  * Compacte stats weergave met iconen en getallen (geen aparte cards)
  * Responsive buttons met mobile-first approach (w-full sm:w-auto, size="sm")
  * Mobiel-vriendelijke profielpagina's
  * RecipeCard met "Gevolgd" badge voor gevolgde gebruikers

üîÑ IN PROGRESS:
- Branch protection rules op main
- PWA manifest en service worker
- Real-time updates (Supabase Realtime)

üìã VOLGENDE STAPPEN:
1. Branch protection rules op main
2. PWA manifest en service worker
3. Real-time updates (Supabase Realtime)
4. Performance optimizations en monitoring
5. Zoeken functionaliteit (pg_trgm/Meilisearch)

SUPABASE/DRIZZLE/VERCEL RICHTLIJNEN

* Supabase & DATABASE_URL
  * In productie (Vercel) altijd Pooler gebruiken met `options=project=<ref>` en `sslmode=require`.
    `postgresql://postgres:<pwd>@aws-0-eu-central-1.pooler.supabase.com:5432/postgres?sslmode=require&options=project%3D<ref>`
  * Directe host lokaal alleen gebruiken als DNS/SSL werkt:
    `postgresql://postgres:<pwd>@db.<ref>.supabase.co:5432/postgres?sslmode=require`
  * Service-role key nooit client-side of in logs.
  * RLS verplicht; policies beheren in `drizzle/rls.sql` en uitvoeren via Supabase SQL Editor.

* ENV Conventies
  * Vereist: `NEXT_PUBLIC_SUPABASE_URL`, `NEXT_PUBLIC_SUPABASE_ANON_KEY`, `SUPABASE_SERVICE_ROLE_KEY`, `DATABASE_URL`, `SITE_URL`, `NEXT_PUBLIC_SITE_URL`.
  * `.env.local` nooit committen; Vercel Env Vars gebruiken (Encrypted voor server keys).

* Database Operaties
  * **Runtime queries**: ALTIJD Supabase Admin Client (`createAdminClient()`) gebruiken.
  * **Schema management**: Drizzle ORM alleen voor schema definitie en migraties.
  * **Migraties**: `pnpm drizzle-kit generate` ‚Üí `pnpm drizzle-kit push`.
  * **NIET gebruiken**: Drizzle ORM voor runtime database queries in server actions/API routes.
  * **Consistentie**: Alle database operaties via Supabase Admin Client voor betrouwbaarheid.

* Next.js 15 + Supabase SSR
  * `createClient()` in `src/lib/supabase/server.ts` is async; altijd `await createClient()`.
  * `cookies()` is async in App Router; eerst `const cookieStore = await cookies()`.

* Performance Best Practices
  * **Server-side data fetching**: Pre-fetch data in server components voor initial page loads.
  * **Client-side updates**: Gebruik client components voor real-time updates na form submissions.
  * **Loading states**: Minimaliseer loading states door server-side data fetching.
  * **Cache invalidation**: `revalidatePath()` na mutaties voor cache updates.
  * **Parallel fetching**: Gebruik `Promise.all()` voor meerdere API calls.

* Beveiliging & Storage
  * `photos` bucket is private; serveer via signed URLs. [Aangemaakt]
  * Na mutaties: `revalidatePath`/`